<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="author" content="Eric"><meta name="keywords" content=""><meta name="description" content="数据提取(1)数据提取
概念：从响应中获取我们想要的数据的过程

数据分类
非结构化的数据：html等

处理方法：正则表达式、xpath


结构化数据：json、xml等

处理方法：转化为python数据类型
数据提取之json


由于把json数据转化为python内建数据类型很简单..."><meta name="Robots" content="all"><title>Eric个人博客 | 爬虫(三)——数据提取(1)</title><link rel="icon" href="/images/icon.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/highlight.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Eric个人博客" type="application/atom+xml"></head><body><div class="main-container"><header class="header"><div class="global-width"><nav class="nav-box"><a class="nav-item" href="/">主页</a> <a class="nav-item" href="/resume">项目</a> <a class="nav-item" href="/mood" target="_blank">热点观点</a> <a class="nav-item" href="/2018/01/01/introduce/" target="_blank">个人介绍</a> <a class="nav-item" href="/fuye.md">关于</a></nav></div></header><section class="content global-width"><div class="main"><article class="box post"><div class="post-title align-center detail-title">爬虫(三)——数据提取(1)</div><div class="post-meta align-center"><span class="label">原创</span> <span class="dotted">|</span> <i class="fa fa-calendar"></i> <time>2019-03-03</time> <span class="dotted">|</span> <i class="fa fa-user"></i> Eric <span class="dotted">|</span> <i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></div><div class="post-content"><h1 id="数据提取-1"><a href="#数据提取-1" class="headerlink" title="数据提取(1)"></a>数据提取(1)</h1><h4 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h4><ul><li>概念：从响应中获取我们想要的数据的过程</li></ul><h4 id="数据分类"><a href="#数据分类" class="headerlink" title="数据分类"></a>数据分类</h4><ul><li><p>非结构化的数据：html等</p><ul><li>处理方法：正则表达式、xpath</li></ul></li><li><p>结构化数据：json、xml等</p><ul><li>处理方法：转化为python数据类型<a id="more"></a><h4 id="数据提取之json"><a href="#数据提取之json" class="headerlink" title="数据提取之json"></a>数据提取之<font color="red">json</font></h4></li></ul></li><li><p>由于把json数据转化为python内建数据类型很简单，所以爬虫中，<font color="red">如果我们能够找到返回json的URL，就会尽量使用这种URL</font>。</p></li><li><p>JSON的概念：是一种轻量级的<font color="red">数据交换格式</font>,它使得人们很容易的进行阅读和编写。同时也方便了机器进行解析和生成。适用于<font color="red">进行数据交互的场景</font>,比如网站前台与后台之间的数据交互。</p></li><li><p>如何找到json的url</p><ul><li>使用chrome切换到手机页面<ul><li>寻找想要提取的数据的json</li><li>JSONView插件</li></ul></li><li>使用抓包app</li></ul></li><li><p>json字符串与python数据类型之间的转化</p><ul><li><code>json.loads()</code>可以把json字符串转化为python数据类型(字典）<ul><li>可以使用pprint格式化输出</li></ul></li><li><code>json.dumps()</code>可以把python数据类型转化为json字符串<ul><li>由于文件中不能直接写入字典，所以需要转化成字符串<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span>  pprint   <span class="comment">#格式化输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里的header中要加入referer因为豆瓣会判断是从哪里访问的无法直接发送请求</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Mobile Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://www.baidu.com/s?wd=https%3A%2F%2Fm.douban.com%2Frexxar%2Fapi%2Fv2%2Fmovie%2Fmodules%3Ffor_mobile%3D1&amp;rsv_spt=1&amp;rsv_iqid=0xa31d1229007d429f&amp;issp=1&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=2&amp;ie=utf-8&amp;rqlang=cn&amp;tn=baiduhome_pg&amp;rsv_enter=1&amp;rsv_dl=tb&amp;oq=%25E8%25B1%2586%25E7%2593%25A3%25E7%2588%25AC%25E5%258F%2596%25E7%259A%2584jsonurl%25E6%2597%25A0%25E6%25B3%2595%25E4%25BD%25BF%25E7%2594%25A8&amp;rsv_t=9888CbGuwCjegyn3%2BOahTHhabDdeymSywmAFOx6FHg1Ivx8uUQQq%2FGeqiDu4DqlOAgf1&amp;inputT=670&amp;rsv_pq=f7f383570018a710&amp;rsv_n=2&amp;rsv_sug3=46&amp;rsv_sug2=0&amp;rsv_sug4=670&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://m.douban.com/rexxar/api/v2/movie/modules?for_mobile=1&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(response)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这样不加转换会直接就是str类型</span></span><br><span class="line"><span class="comment"># print(response.content.decode())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用json.loads把json字符串转化为python类型(字典）</span></span><br><span class="line">ret1 = json.loads(response.content.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;douban.json&quot;</span>,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 文件默认写入方式是ascii，这里用ensure_ascii=False就不是ascii写入utf-8</span></span><br><span class="line">    <span class="comment"># 下一集在上一级的基础上退后两格</span></span><br><span class="line">    f.write(json.dumps(ret1,ensure_ascii=<span class="literal">False</span>,indent=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">pprint(ret1)</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>包含json的类文件对象与python数据类型之间的转化<font color="red">（具有read()或者write()方法的对象就是类文件对象，例：f=open(“a.txt”,”r”) f就是类文件对象）</font></p><ul><li><code>json.load()</code>把包含json的类文件对象转化为python</li><li><code>json.dump()</code>把数据类型转化为包含json的类文件对象<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;douban.json&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ret2 = f.read()</span><br><span class="line">    ret3 = json.loads(ret2)</span><br><span class="line">    print(ret3)</span><br><span class="line"><span class="comment"># 相较之下，直接使用json.load提取json中的数据，省去了一不f.read()   </span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;douban.json&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ret4 = json.load(ret2)</span><br><span class="line">    print(ret3)</span><br><span class="line">*******************</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;douban.json&quot;</span>,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(ret1,ensure_ascii=<span class="literal">False</span>,indent=<span class="number">2</span>))</span><br><span class="line"><span class="comment"># json.dump能够把python类型放入类文件对象中</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;douban1.json&quot;</span>,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(ret1,f,ensure_ascii=<span class="literal">False</span>,indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>json使用<font color="red">注意点</font></p><ul><li>json中的字符串都是双引号引起来的</li><li>如果不是双引号就不是json<ul><li>可以使用eval把简单的字符串和python类型的转换</li><li>replace:把单引号替换为双引号</li></ul></li><li>往一个文件中写入多个json串，不再是一个json串，不能直接读取<ul><li>一行写一个json串，按照行来读取</li></ul></li></ul></li><li><p>Json在数据交换中起到了一个载体的作用，承载着相互传递的数据</p><ul><li>Json与js，java，python有一种一一对应关系</li><li>XML没有与其他语言的对应关系，只能手动解析</li></ul></li></ul><hr><h2 id="续-数据提取之正则表达式"><a href="#续-数据提取之正则表达式" class="headerlink" title="(续)数据提取之正则表达式"></a>(续)数据提取之<font color="red">正则表达式</font></h2></div></article></div><div class="aside"><div class="box widget"><div class="introduction"><p><img src="/images/ironman.jpg" alt="head-sculpture"></p><p class="name">罗明辉Eric</p><p class="slogan">个人博客，分享经验，分享快乐</p></div></div><div class="box widget"><div class="title">最新</div><ul class="item-box"><li><a href="/2020/11/13/BigDataFrame/Flink/">Flink</a></li><li><a href="/2020/11/05/BigDataFrame/canal/">Canal</a></li><li><a href="/2020/09/26/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1/">数据仓库-建模</a></li><li><a href="/2020/09/20/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%9E%B6%E6%9E%84/">数据仓库-架构</a></li><li><a href="/2020/09/19/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E8%BF%B0/">数据仓库-概述</a></li><li><a href="/2020/09/18/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li><a href="/2020/09/10/BigDataFrame/YARN/">YARN</a></li><li><a href="/2020/09/06/BigDataFrame/HDFS%E8%81%94%E9%82%A6%E6%9C%BA%E5%88%B6/">HDFS联邦机制</a></li></ul></div><div class="box widget"><div class="title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BI%E5%B7%A5%E5%85%B7/">BI工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETL%E5%B7%A5%E5%85%B7/">ETL工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="box widget"><div class="title">归档</div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">2020-11</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">2020-05</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020-01</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a><span class="archive-list-count">1</span></li></ul></div></div></section><footer class="footer"><div class="global-width footer-box"><div class="copyright"><span>Copyright &copy; 2020</span> <span class="dotted">|</span> <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="dotted">|</span></div></div></footer></div><script>hljs.initHighlightingOnLoad()</script></body></html>