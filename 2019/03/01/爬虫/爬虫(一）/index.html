<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="author" content="Eric"><meta name="keywords" content=""><meta name="description" content="爬虫学习(一)一.爬虫的概念
模拟客户端(浏览器)发送网络请求，接收请求响应，一种按照一定的规则，自动的抓取互联网信息的程序。

二.爬虫的流程
url–&gt;发送请求，获取响应–&gt;提取数据–&gt;入库
发送请求，获取响应–&gt;提取url


三.ROBOTS协议
网站通过Rob..."><meta name="Robots" content="all"><title>Hexo | 爬虫（一）</title><link rel="icon" href="/images/icon.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/highlight.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body><div class="main-container"><header class="header"><div class="global-width"><nav class="nav-box"><a class="nav-item" href="/">主页</a> <a class="nav-item" href="/resume">项目</a> <a class="nav-item" href="/mood" target="_blank">热点观点</a> <a class="nav-item" href="/2018/01/01/introduce/" target="_blank">个人介绍</a> <a class="nav-item" href="/fuye.md">关于</a></nav></div></header><section class="content global-width"><div class="main"><article class="box post"><div class="post-title align-center detail-title">爬虫（一）</div><div class="post-meta align-center"><span class="label">原创</span> <span class="dotted">|</span> <i class="fa fa-calendar"></i> <time>2019-03-01</time> <span class="dotted">|</span> <i class="fa fa-user"></i> Eric <span class="dotted">|</span> <i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></div><div class="post-content"><h1 id="爬虫学习-一"><a href="#爬虫学习-一" class="headerlink" title="爬虫学习(一)"></a>爬虫学习(一)</h1><h3 id="一-爬虫的概念"><a href="#一-爬虫的概念" class="headerlink" title="一.爬虫的概念"></a>一.爬虫的概念</h3><ul><li>模拟客户端(浏览器)发送网络请求，接收请求响应，一种按照一定的规则，自动的抓取互联网信息的程序。</li></ul><h3 id="二-爬虫的流程"><a href="#二-爬虫的流程" class="headerlink" title="二.爬虫的流程"></a>二.爬虫的流程</h3><ul><li>url–&gt;发送请求，获取响应–&gt;提取数据–&gt;入库</li><li>发送请求，获取响应–&gt;提取url<br><img src="https://img-blog.csdnimg.cn/20190821183858315.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzE3MDg2Mw==,size_16,color_FFFFFF,t_70" alt="两种不同爬虫的实现流程"></li></ul><a id="more"></a><h3 id="三-ROBOTS协议"><a href="#三-ROBOTS协议" class="headerlink" title="三.ROBOTS协议"></a>三.ROBOTS协议</h3><ul><li>网站通过Robots协议告诉搜索引擎哪些页面可以抓取，哪些页面不可以抓取。例如：<a target="_blank" rel="noopener" href="https://www.taobao.com/robots.txt">https://www.taobao.com/robots.txt</a></li></ul><h3 id="题外："><a href="#题外：" class="headerlink" title="题外："></a>题外：</h3><hr><p>先看图<br><img src="https://img-blog.csdnimg.cn/20190821183952176.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzE3MDg2Mw==,size_16,color_FFFFFF,t_70" alt="浏览器发送HTTP请求的过程"></p><h4 id="1-HTTP和HTTPS-相比多了一个加密解密的过程，更安全但性能较低"><a href="#1-HTTP和HTTPS-相比多了一个加密解密的过程，更安全但性能较低" class="headerlink" title="1.HTTP和HTTPS:相比多了一个加密解密的过程，更安全但性能较低"></a>1.HTTP和HTTPS:相比多了一个加密解密的过程，更安全但性能较低</h4><h4 id="2-爬虫要根据当前url地址对应的响应-response-为准，当前url地址的element的内容和url的响应不一样"><a href="#2-爬虫要根据当前url地址对应的响应-response-为准，当前url地址的element的内容和url的响应不一样" class="headerlink" title="2.爬虫要根据当前url地址对应的响应(response)为准，当前url地址的element的内容和url的响应不一样"></a>2.爬虫要根据当前url地址对应的响应(response)为准，当前url地址的element的内容和url的响应不一样</h4><h4 id="3-DNS服务器：实现域名的解析成IP地址"><a href="#3-DNS服务器：实现域名的解析成IP地址" class="headerlink" title="3.DNS服务器：实现域名的解析成IP地址"></a>3.DNS服务器：实现域名的解析成IP地址</h4><h4 id="4-浏览器渲染-element-出来的页面和爬虫请求-response-的页面不一样"><a href="#4-浏览器渲染-element-出来的页面和爬虫请求-response-的页面不一样" class="headerlink" title="4.浏览器渲染(element)出来的页面和爬虫请求(response)的页面不一样"></a>4.浏览器渲染(element)出来的页面和爬虫请求(response)的页面不一样</h4><hr><h3 id="四-页面上的数据在哪里"><a href="#四-页面上的数据在哪里" class="headerlink" title="四.页面上的数据在哪里"></a>四.页面上的数据在哪里</h3><ul><li>当前url地址对应的相应中</li><li>其他的url地址对应的响应中<ul><li>比如ajax请求中</li></ul></li><li>js生成的<ul><li>部分数据在响应中</li><li>全部通过js生成</li></ul></li></ul><h3 id="五-url的形式"><a href="#五-url的形式" class="headerlink" title="五.url的形式"></a>五.url的形式</h3><ul><li>形式 scheme://host[:port#]/path/…/[?query-string][#anchor]<ul><li><a target="_blank" rel="noopener" href="http://localhost:4000/file/part01/1.2.html">http://localhost:4000/file/part01/1.2.html</a></li><li><a target="_blank" rel="noopener" href="http://item.jd.com/11936238.html#product-detail">http://item.jd.com/11936238.html#product-detail</a> 带上锚点直接定位详情</li></ul></li><li>参考文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/amberinheart/article/details/78814540">https://blog.csdn.net/amberinheart/article/details/78814540</a></li></ul><h3 id="六-HTTP常见请求头-User-Agent-Cookies"><a href="#六-HTTP常见请求头-User-Agent-Cookies" class="headerlink" title="六.HTTP常见请求头(User-Agent,Cookies)"></a>六.HTTP常见请求头(User-Agent,Cookies)</h3><ul><li>为了和浏览器更像</li><li>Host(主机和端口号)</li><li>Connection(链接类型)</li><li>Upgrade-Insecure-Requests(升级为HTTPS请求)</li><li><font color="red">User-Agent(浏览器名称)</font></li><li>Accept(传输文件类型)</li><li>Referer(页面跳转处)</li><li>Accept-Encoding(文件编解码格式)</li><li><font color="red">Cookie(Cookie)</font><ul><li>与session的区别：cookie保存在浏览器本地相对不安全有上限，而session保存在服务器足够大就可以存</li></ul></li><li>x-requested-with:XMLHttpRequest(是Ajax异步请求)</li></ul><h3 id="七-常见响应状态码"><a href="#七-常见响应状态码" class="headerlink" title="七.常见响应状态码"></a>七.常见响应状态码</h3><ul><li>200：成功</li><li>302：临时转移至新的url</li><li>307：临时转移至新的url</li><li>404：Not found</li><li>500：服务器内部错误</li></ul><h3 id="八-常见的请求方式"><a href="#八-常见的请求方式" class="headerlink" title="八.常见的请求方式"></a>八.常见的请求方式</h3><ul><li>GET</li><li>POST</li><li>区别：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37932082/article/details/79452475">https://blog.csdn.net/qq_37932082/article/details/79452475</a></li></ul><h3 id="九-字符串的分类"><a href="#九-字符串的分类" class="headerlink" title="九.字符串的分类"></a>九.字符串的分类</h3><ul><li>bytes类型<ul><li>二进制类型</li><li>互联网上数据都是以二进制的方式传输</li></ul></li><li>str类型<ul><li>unicode的呈现形式</li><li>UTF-8是Unicode字符集的实现方式，是一种变长的编码方式</li></ul></li><li><font color="red">编码方式解码方式必须一样，否则就会出现乱码</font><ul><li><code>b = a.encode()</code> 把str转化为bytes</li><li><code>a = b.decode(&quot;utf-8&quot;)</code> 把bytes转化为str类型</li></ul></li></ul><h3 id="十-Request-使用入门"><a href="#十-Request-使用入门" class="headerlink" title="十.Request 使用入门"></a>十.Request 使用入门</h3><ul><li><p>为什么要学习requests，而不是urllib?</p><ul><li>1.requests的底层实现就是urllib，urllib能做的requests都能做，而且更简单</li><li>2.requests在python2和python3中通用，方法完全<br>一样</li><li>3.requests简单易用</li><li>4.requests能够自动帮助我们解压(gzip压缩的等)网页内容</li></ul></li><li><p>作用：发送网络请求，返回响应数据</p></li><li><p>中文文档API ：<a target="_blank" rel="noopener" href="https://2.python-requests.org//zh_CN/latest/index.html">https://2.python-requests.org//zh_CN/latest/index.html</a></p></li><li><p>requests中解决编解码的方法</p><ul><li><code>response.content.decode()</code> 默认使用utf-8解码(推荐)</li><li><code>response.content.decode(&quot;gbk&quot;)</code></li><li><code>response.text</code> 依靠requests模块进行推测</li></ul></li><li><p>使用requests来发送网络请求</p><ul><li><code>response = requests.get(url)</code></li><li>response常用方法<ul><li><code>response.text</code></li><li><code>response.content</code></li><li><code>response.status_code</code></li><li><code>response.request.headers</code></li><li><code>response.headers</code></li></ul></li><li>判断请求是否成功<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> response.status_code==<span class="number">200</span></span><br></pre></td></tr></table></figure></li><li>查看reponse.url(当发生跳转时两个url可能不一样)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">10</span>]: response.url</span><br><span class="line">Out[<span class="number">10</span>]: <span class="string">&#x27;https://www.baidu.com/&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查看respons.request.url<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">11</span>]: response.request.url</span><br><span class="line">Out[<span class="number">11</span>]: <span class="string">&#x27;https://www.baidu.com/&#x27;</span></span><br></pre></td></tr></table></figure></li><li>查看response.headers<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: response.headers</span><br><span class="line">Out[<span class="number">7</span>]: &#123;<span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;private, no-cache, no-store, proxy-revalidate, no-transform&#x27;</span>, <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;Keep-Alive&#x27;</span>, <span class="string">&#x27;Content-Encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>: <span class="string">&#x27;Wed, 21 Aug 2019 09:51:37 GMT&#x27;</span>, <span class="string">&#x27;Last-Modified&#x27;</span>: <span class="string">&#x27;Mon, 23 Jan 2017 13:23:51 GMT&#x27;</span>, <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>, <span class="string">&#x27;Server&#x27;</span>: <span class="string">&#x27;bfe/1.0.8.18&#x27;</span>, <span class="string">&#x27;Set-Cookie&#x27;</span>: <span class="string">&#x27;BDORZ=27315; max-age=86400; domain=.baidu.com; path=/&#x27;</span>, <span class="string">&#x27;Transfer-Encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li><li>查看请求的headers<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: response.request.headers</span><br><span class="line">Out[<span class="number">9</span>]: &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;python-requests/2.22.0&#x27;</span>, <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>, <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>, <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>发送带header的请求</p><ul><li><p>存在问题：由于’User-Agent’: ‘python-requests/2.22.0’百度的服务器识别出我们不是通过浏览器<br>访问的，所以我们要发送带header的请求。</p></li><li><p>目的：模拟浏览器，欺骗服务器，获取和浏览器一致的内容</p></li><li><p>header的形式：字典</p><ul><li><code>&#123;&#39;User-Agent&#39;: &#39;python-requests/2.22.0&#39;, &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;, &#39;Accept&#39;: &#39;*/*&#39;, &#39;Connection&#39;: &#39;keep-alive&#39;&#125;</code></li></ul></li><li><p>用法： requests.get(url,headers=headers)</p></li><li><pre><code class="python">    In [16]: headers = &#123;&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chr
         ...: ome/76.0.3809.100 Safari/537.36&quot;&#125;
    In [17]: response = requests.get(&quot;http://www.baidu.com&quot;,headers = headers)
    In [19]: response.content.decode()
    Out[19]: 太多了直接取百度的response中看就行，是一样的
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     </span><br><span class="line">- 发送带参数的请求</span><br><span class="line">   - https:&#x2F;&#x2F;www.baidu.com&#x2F;swd&#x3D;python&amp;rsv_spt&#x3D;1&amp;rsv_iqid&#x3D;0x85e9b6aa00036fc0&amp;issp&#x3D;1&amp;f&#x3D;8&amp;rsv_bp&#x3D;1&amp;rsv_idx&#x3D;2&amp;ie&#x3D;utf8&amp;tn&#x3D;baiduhome_pg&amp;rsv_enter&#x3D;1&amp;rsv_dl&#x3D;ib&amp;rsv_sug3&#x3D;6&amp;rsv_sug1&#x3D;4&amp;rsv_sug7&#x3D;100中？后面(...)&#x3D;...就是参数用&amp;隔开，这里只有wd&#x3D;python这个有用</span><br><span class="line">   - 请求参数：</span><br><span class="line">      - https:&#x2F;&#x2F;www.baidu.com&#x2F;s?wd&#x3D;python&amp;c&#x3D;b</span><br><span class="line">   - 参数的形式：字典</span><br><span class="line">   - 如何添加params：</span><br><span class="line">   &#96;&#96;&#96;python</span><br><span class="line">       p &#x3D; &#123;&quot;wd&quot;:&quot;python&quot;&#125;</span><br><span class="line">       response &#x3D; requests.get(url_temp,headers&#x3D;headers,params&#x3D;p)</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>URL编码</p><ul><li><a target="_blank" rel="noopener" href="https://www.baidu.com/?wd=%E4%B8%AD%E5%9B%BD">https://www.baidu.com/?wd=%E4%B8%AD%E5%9B%BD</a></li><li><a target="_blank" rel="noopener" href="https://www.baidu.com/?wd=&quot;%E4%B8%AD%E5%9B%BD&quot;">https://www.baidu.com/?wd=&quot;中国&quot;</a></li></ul></li></ul><hr><h2 id="续-：深入requests"><a href="#续-：深入requests" class="headerlink" title="(续)：深入requests"></a>(续)：深入requests</h2></div></article></div><div class="aside"><div class="box widget"><div class="introduction"><p><img src="/images/ironman.jpg" alt="head-sculpture"></p><p class="name">罗明辉Eric</p><p class="slogan">个人博客，分享经验，分享快乐</p></div></div><div class="box widget"><div class="title">最新</div><ul class="item-box"><li><a href="/2020/09/03/ETL/Kettle/">Kettle</a></li><li><a href="/2020/08/10/BI/Tebleau/">Tebleau</a></li><li><a href="/2020/08/05/BI/PowerBI/">PowerBI</a></li><li><a href="/2020/07/28/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E8%AF%AD%E5%8F%A5%E8%B0%83%E4%BC%98/">SQL语句调优</a></li><li><a href="/2020/07/25/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql%E5%8E%9F%E7%90%86/">Mysql底层原理</a></li><li><a href="/2020/07/15/BigDataFrame/HBase%E5%85%A5%E9%97%A8/">HBase入门</a></li><li><a href="/2020/07/05/BigDataFrame/Hive%E9%AB%98%E9%98%B6/">Hive高阶</a></li><li><a href="/2020/07/01/BigDataFrame/Hive%E5%85%A5%E9%97%A8/">Hive入门</a></li></ul></div><div class="box widget"><div class="title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BI%E5%B7%A5%E5%85%B7/">BI工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETL%E5%B7%A5%E5%85%B7/">ETL工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="box widget"><div class="title">归档</div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">2020-08</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020-01</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a><span class="archive-list-count">1</span></li></ul></div></div></section><footer class="footer"><div class="global-width footer-box"><div class="copyright"><span>Copyright &copy; 2020</span> <span class="dotted">|</span> <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="dotted">|</span> <span>Theme by <a href="javascript:">Luominghui</a></span> <span class="dotted">|</span></div></div></footer></div><script>hljs.initHighlightingOnLoad()</script></body></html>