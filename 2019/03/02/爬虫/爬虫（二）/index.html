<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="author" content="Eric"><meta name="keywords" content=""><meta name="description" content="爬虫(二)Requests深入1.发送POST请求
哪些地方需要发送POST请求：

登陆注册 (POST比GET更安全)
需要传输大文本内容的时候(POST请求对数据长度没有要求)


用法：

response = requests.post(“http://www.baidu.com/&..."><meta name="Robots" content="all"><title>Eric个人博客 | 爬虫（二）</title><link rel="icon" href="/images/icon.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/highlight.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Eric个人博客" type="application/atom+xml"></head><body><div class="main-container"><header class="header"><div class="global-width"><nav class="nav-box"><a class="nav-item" href="/">主页</a> <a class="nav-item" href="/resume">项目</a> <a class="nav-item" href="/mood" target="_blank">热点观点</a> <a class="nav-item" href="/2018/01/01/introduce/" target="_blank">个人介绍</a> <a class="nav-item" href="/fuye.md">关于</a></nav></div></header><section class="content global-width"><div class="main"><article class="box post"><div class="post-title align-center detail-title">爬虫（二）</div><div class="post-meta align-center"><span class="label">原创</span> <span class="dotted">|</span> <i class="fa fa-calendar"></i> <time>2019-03-02</time> <span class="dotted">|</span> <i class="fa fa-user"></i> Eric <span class="dotted">|</span> <i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></div><div class="post-content"><h1 id="爬虫-二"><a href="#爬虫-二" class="headerlink" title="爬虫(二)"></a>爬虫(二)</h1><h2 id="Requests深入"><a href="#Requests深入" class="headerlink" title="Requests深入"></a>Requests深入</h2><h4 id="1-发送POST请求"><a href="#1-发送POST请求" class="headerlink" title="1.发送POST请求"></a>1.发送POST请求</h4><ul><li><p>哪些地方需要发送POST请求：</p><ul><li><font color="red">登陆注册</font> (POST比GET更安全)</li><li>需要传输<font color="red">大文本</font>内容的时候(POST请求对数据长度没有要求)</li></ul></li><li><p>用法：</p><ul><li>response = requests.post(“<a target="_blank" rel="noopener" href="http://www.baidu.com/&quot;,data">http://www.baidu.com/&quot;,data</a> = data,headers=headers)</li><li>data的形式：字典<h4 id="2-使用代理"><a href="#2-使用代理" class="headerlink" title="2.使用代理"></a>2.使用代理</h4><a id="more"></a></li></ul></li><li><p>用法：requests.get(“<a target="_blank" rel="noopener" href="http://www.baidu.com&quot;,proxies=proxies/">http://www.baidu.com&quot;,proxies=proxies</a>)</p></li><li><p>proxies的形式：字典</p></li><li><p><code>proxies = &#123;&quot;http&quot;:&quot;http://12.34.56.79:9527&quot;,&quot;https&quot;:&quot;https://12.34.56.79:9537&quot;&#125;</code></p></li><li><p>正向代理和反向代理区别：<font color="red">转载</font><a target="_blank" rel="noopener" href="https://blog.csdn.net/liuhenghui5201/article/details/90720442">https://blog.csdn.net/liuhenghui5201/article/details/90720442</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://163.177.151.23:80&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&quot;http://www.baidu.com&quot;</span>,proxies=proxies,headers=headers)</span><br><span class="line"></span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure></li><li><p>为什么爬虫需要使用代理</p><ul><li>让服务器以为<font color="red">不是同一个客户端</font>在发送请求</li><li>防止我们<font color="red">真实地址</font>被泄露，防止被追究</li></ul></li><li><p>准备一堆ip地址，组成ip池，随机选择一个ip来使用</p></li><li><p>如何随机选择代理ip</p><ul><li><code>&#123;&quot;ip&quot;:ip,&quot;times&quot;:0&#125;</code></li><li>[{},{},{},{}],对这个ip列表进行排序，按照使用次数进行排序</li><li>选择使用次数较少的10个ip，从中随机选择一个</li></ul></li><li><p>检查ip的可用性</p><ul><li>可以使用requests添加超时参数，判断ip地址的质量</li><li>在线代理ip质量检测网站</li></ul></li></ul><h4 id="cookie和session的区别"><a href="#cookie和session的区别" class="headerlink" title="cookie和session的区别"></a>cookie和session的区别</h4><ul><li>cookie数据存放在客户的<font color="red">浏览器</font>上，session数据放在<font color="red">服务器</font>上</li><li>cookie不是很<font color="red">安全</font>，别人可以分析存放在本地的cookie并进行cookie欺骗。</li><li>session会在一定时间内保存在服务器上。当访问增多，会比较占用服务器的<font color="red">性能</font>。</li><li>单个cookie保存的数据不能超过<font color="red">4k</font>，很多浏览器都限制一个站点最多保存20个cookie</li></ul><h4 id="携带cookie请求"><a href="#携带cookie请求" class="headerlink" title="携带cookie请求"></a>携带cookie请求</h4><ul><li>携带一堆cookie进行请求，把cookie组成cookie池</li><li>随机选择cookie</li><li>检查cookie的可用性<h4 id="爬虫处理cookie和session"><a href="#爬虫处理cookie和session" class="headerlink" title="爬虫处理cookie和session"></a>爬虫处理cookie和session</h4></li><li>带上cookie、session的好处：<ul><li>能够请求到<font color="red">登陆</font>之后的页面</li></ul></li><li>带上cookie、session的弊端：<ul><li>一套cookie和session往往和一个用户对应</li><li>请求太快，请求次数太多，容易被服务器识别为爬虫<ul><li><font color="red">不需要cookie的时候尽量不去使用cookie</font></li><li>但是为了<font color="red">获取登陆之后的页面</font>，我们必须发送带有cookies的请求</li></ul></li></ul></li></ul><h4 id="处理cookies、session请求"><a href="#处理cookies、session请求" class="headerlink" title="处理cookies、session请求"></a>处理cookies、session请求</h4><ul><li>requests提供了一个叫做session类，来实现客户端和服务器的<font color="red">会话保持</font></li><li>使用方法：<ul><li>实例化一个session对象</li><li>让session发送get或者post请求</li></ul></li><li>使用requests提供的session类来请求登陆之后的网站的思路<ul><li>实例化session</li><li>先使用session发送请求，登陆对应网站，把cookie保存在session中</li><li>再使用session请求登陆之后才能访问的网站，session能够自动的携带登陆成功时保存再其中的cookie，进行请求.</li></ul></li><li>尝试使用session获得到的cookie请求登陆后的人人网的个人主页<br><font color="red">注意：这里的post_url是在form表单的action中，action中的内容就是要提交到的地址<br>·········两个input中的name作为键，value作为值组成键值对<br>·········并不是</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">post_url = <span class="string">&quot;http://www.renren.com/PLogin.do&quot;</span></span><br><span class="line"></span><br><span class="line">post_data = &#123;<span class="string">&quot;email&quot;</span>:<span class="string">&quot;自己的账号&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;自己的密码&quot;</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用session发送post请求，cookie保存在其中</span></span><br><span class="line">session.post(post_url,data=post_data,headers=headers)</span><br><span class="line"><span class="comment">#再使用session进行请求登陆之后才能访问的地址</span></span><br><span class="line">r = session.get(<span class="string">&quot;http://www.renren.com/972058238/profile&quot;</span>,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存页面</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;renren1.html&quot;</span>,<span class="string">&quot;w&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.content.decode())</span><br></pre></td></tr></table></figure><font color="red">注意：使用登陆后的cookie也可以直接登陆</font></li></ul><h4 id="不发送post请求，使用cookie获取登陆后的页面"><a href="#不发送post请求，使用cookie获取登陆后的页面" class="headerlink" title="不发送post请求，使用cookie获取登陆后的页面"></a>不发送post请求，使用cookie获取登陆后的页面</h4><ul><li>cookie过期时间很长的网站</li><li>在cookie过期之前能够拿到所有数据，比较麻烦</li><li>配合其他程序一起使用，其他程序专门获取cookie，当前程序专门请求页面</li></ul><h4 id="获取登陆后的页面的三种方式"><a href="#获取登陆后的页面的三种方式" class="headerlink" title="获取登陆后的页面的三种方式"></a>获取登陆后的页面的三种方式</h4><ul><li>实例化session，使用session发送post请求，在使用它获取登陆后的页面</li><li>headers中添加cookie健，值为cookie字符串</li><li>在请求方式中添加cookies参数，接收字典形式的cookie中的键值对,键是cookies的name，值是value<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: cookie = <span class="string">&quot;anonymid=jzmaqsbw-7vlpw2; _r01_=1; depovince=TJ; JSESSIONID=abcYOgD9u8vMFgWooJnZw; ick_login=3ab61d2b</span></span><br><span class="line"><span class="string">   ...: -8dfb-45c4-bef0-f3e7645ca185; ick=d1b131e9-3151-4f83-a7dd-6b91f305ee31; XNESSESSIONID=2104332896ae; jebe_key=e5</span></span><br><span class="line"><span class="string">   ...: b84320-9ee9-4602-881e-0a121176d072%7C439ab05ee3305b84627646d7124c8596%7C1566816885126%7C1%7C1566816834549; jebe</span></span><br><span class="line"><span class="string">   ...: _key=e5b84320-9ee9-4602-881e-0a121176d072%7C439ab05ee3305b84627646d7124c8596%7C1566816885126%7C1%7C156681683455</span></span><br><span class="line"><span class="string">   ...: 1; jebecookies=2cf03718-4b31-4d8a-9b16-2061f622a96b|||||; _de=66DD231F19329CA30F19516F0C7507CF; p=0a32de0b06fb3</span></span><br><span class="line"><span class="string">   ...: fa51346ff02e430e87c8; first_login_flag=1; ln_uact=17551626656; ln_hurl=http://head.xiaonei.com/photos/0/0/men_m</span></span><br><span class="line"><span class="string">   ...: ain.gif; t=9a5d4f638972330b9bc83e8cc0bbfb958; societyguester=9a5d4f638972330b9bc83e8cc0bbfb958; id=972058238; x</span></span><br><span class="line"><span class="string">   ...: nsid=3267b423; ver=7.0; loginfrom=null&quot;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: cookies = &#123;i.split(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>]:i.split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> cookie.split(<span class="string">&quot;; &quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: cookies</span><br><span class="line">Out[<span class="number">4</span>]:</span><br><span class="line">&#123;<span class="string">&#x27;anonymid&#x27;</span>: <span class="string">&#x27;jzmaqsbw-7vlpw2&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;_r01_&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;depovince&#x27;</span>: <span class="string">&#x27;TJ&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;JSESSIONID&#x27;</span>: <span class="string">&#x27;abcYOgD9u8vMFgWooJnZw&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ick_login&#x27;</span>: <span class="string">&#x27;3ab61d2b-8dfb-45c4-bef0-f3e7645ca185&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ick&#x27;</span>: <span class="string">&#x27;d1b131e9-3151-4f83-a7dd-6b91f305ee31&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;XNESSESSIONID&#x27;</span>: <span class="string">&#x27;2104332896ae&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;jebe_key&#x27;</span>: <span class="string">&#x27;e5b84320-9ee9-4602-881e-0a121176d072%7C439ab05ee3305b84627646d7124c8596%7C1566816885126%7C1%7C1566816834551&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;jebecookies&#x27;</span>: <span class="string">&#x27;2cf03718-4b31-4d8a-9b16-2061f622a96b|||||&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;_de&#x27;</span>: <span class="string">&#x27;66DD231F19329CA30F19516F0C7507CF&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;0a32de0b06fb3fa51346ff02e430e87c8&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;first_login_flag&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ln_uact&#x27;</span>: <span class="string">&#x27;17551626656&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ln_hurl&#x27;</span>: <span class="string">&#x27;http://head.xiaonei.com/photos/0/0/men_main.gif&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;9a5d4f638972330b9bc83e8cc0bbfb958&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;societyguester&#x27;</span>: <span class="string">&#x27;9a5d4f638972330b9bc83e8cc0bbfb958&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;972058238&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;xnsid&#x27;</span>: <span class="string">&#x27;3267b423&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ver&#x27;</span>: <span class="string">&#x27;7.0&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;loginfrom&#x27;</span>: <span class="string">&#x27;null&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="寻找登陆的post地址"><a href="#寻找登陆的post地址" class="headerlink" title="寻找登陆的post地址"></a>寻找登陆的post地址</h3><ul><li><p>在form表单中寻找action对应的url地址</p><ul><li>post的数据是input标签中name的值作为键，真正的用户名密码作为值的<font color="red">字典</font></li></ul></li><li><p>抓包，寻找登陆的url地址</p><ul><li>勾选perserve log按钮，防止页面跳转找不到url</li><li>寻找post数据，确定参数<ul><li>参数不会变，直接用，比如密码不是动态加密的时候</li><li>参数会变<ul><li>在当前的响应中</li><li>通过js生成</li></ul></li></ul></li></ul></li><li><p>定位想要的js</p><ul><li>选择会触发js时间的按钮，点击event listener，找到js的位置</li><li>通过chrome中的search all file来搜索url中的关键字</li><li>添加断点的方式来查看js的操作，通过python来进行同样的操作(较为麻烦，有更简单的方法)</li></ul></li></ul><h3 id="Request小技巧"><a href="#Request小技巧" class="headerlink" title="Request小技巧"></a>Request小技巧</h3><ul><li><p><code>requests.util.dict_from_cookiejar</code> 把cookie对象转化为字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: response = requests.get(<span class="string">&quot;http://www.baidu.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: response.cookies</span><br><span class="line">Out[<span class="number">8</span>]: &lt;RequestsCookieJar[Cookie(version=<span class="number">0</span>, name=<span class="string">&#x27;BDORZ&#x27;</span>, value=<span class="string">&#x27;27315&#x27;</span>, port=<span class="literal">None</span>, port_specified=<span class="literal">False</span>, domain=<span class="string">&#x27;.baidu.com&#x27;</span>, domain_specified=<span class="literal">True</span>, domain_initial_dot=<span class="literal">True</span>, path=<span class="string">&#x27;/&#x27;</span>, path_specified=<span class="literal">True</span>, secure=<span class="literal">False</span>, expires=<span class="number">1566907860</span>, discard=<span class="literal">False</span>, comment=<span class="literal">None</span>, comment_url=<span class="literal">None</span>, rest=&#123;&#125;, rfc2109=<span class="literal">False</span>)]&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: requests.utils.dict_from_cookiejar(response.cookies)</span><br><span class="line">Out[<span class="number">9</span>]: &#123;<span class="string">&#x27;BDORZ&#x27;</span>: <span class="string">&#x27;27315&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">11</span>]: requests.utils.cookiejar_from_dict(&#123;<span class="string">&#x27;BDORZ&#x27;</span>: <span class="string">&#x27;27315&#x27;</span>&#125;)</span><br><span class="line">Out[<span class="number">11</span>]: &lt;RequestsCookieJar[Cookie(version=<span class="number">0</span>, name=<span class="string">&#x27;BDORZ&#x27;</span>, value=<span class="string">&#x27;27315&#x27;</span>, port=<span class="literal">None</span>, port_specified=<span class="literal">False</span>, domain=<span class="string">&#x27;&#x27;</span>, domain_specified=<span class="literal">False</span>, domain_initial_dot=<span class="literal">False</span>, path=<span class="string">&#x27;/&#x27;</span>, path_specified=<span class="literal">True</span>, secure=<span class="literal">False</span>, expires=<span class="literal">None</span>, discard=<span class="literal">True</span>, comment=<span class="literal">None</span>, comment_url=<span class="literal">None</span>, rest=&#123;<span class="string">&#x27;HttpOnly&#x27;</span>: <span class="literal">None</span>&#125;, rfc2109=<span class="literal">False</span>)]&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>requests.utils.unquote()和requests.utils.quote()</code>对url地址编解码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">16</span>]: requests.utils.unquote(<span class="string">&quot;https%3a%2f%2ftieba.baidu.com%2ff%3fkw%3d%e6%9d%8e%e6%af%85&quot;</span>)</span><br><span class="line">Out[<span class="number">16</span>]: <span class="string">&#x27;https://tieba.baidu.com/f?kw=李毅&#x27;</span></span><br><span class="line">In [<span class="number">18</span>]: requests.utils.quote(<span class="string">&quot;https://tieba.baidu.com/f?kw=李毅&quot;</span>)</span><br><span class="line">Out[<span class="number">18</span>]: <span class="string">&#x27;https%3A//tieba.baidu.com/f%3Fkw%3D%E6%9D%8E%E6%AF%85&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>请求SSL证书验证</p><ul><li><code>response = requests.get(&quot;https://www.12306.com/&quot;,verify=False)</code></li><li>这样就可以访问https的网页</li></ul></li><li><p>设置超时</p><ul><li><code>response = requests.get(url,timeout=10)</code></li></ul></li><li><p>配合状态码判断是否请求成功</p><ul><li><code>assert response.status_code == 200</code></li></ul></li><li><p>retry 模块（当请求失败时，再次发送请求）<font color="red">装饰器</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(stop_max_attempt_number=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_parse_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    print(<span class="string">&quot;*****&quot;</span>)</span><br><span class="line">    response = requests.get(url,headers=headers,timeout=<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">return</span> response.content.decode()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_url</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        html_str = _parse_url(url)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        html_str = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> html_str</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&quot;www.baidu.com/&quot;</span></span><br><span class="line">    print(parse_url(url))</span><br></pre></td></tr></table></figure></li></ul><h3 id="学完了如何获取响应，下一步就是从响应中提取数据（续）"><a href="#学完了如何获取响应，下一步就是从响应中提取数据（续）" class="headerlink" title="学完了如何获取响应，下一步就是从响应中提取数据（续）"></a>学完了如何获取响应，下一步就是从响应中提取数据（续）</h3></div></article></div><div class="aside"><div class="box widget"><div class="introduction"><p><img src="/images/ironman.jpg" alt="head-sculpture"></p><p class="name">罗明辉Eric</p><p class="slogan">个人博客，分享经验，分享快乐</p></div></div><div class="box widget"><div class="title">最新</div><ul class="item-box"><li><a href="/2020/09/18/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li><a href="/2020/09/03/ETL/Kettle/">Kettle</a></li><li><a href="/2020/08/10/BI/Tebleau/">Tebleau</a></li><li><a href="/2020/08/05/BI/PowerBI/">PowerBI</a></li><li><a href="/2020/07/28/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E8%AF%AD%E5%8F%A5%E8%B0%83%E4%BC%98/">SQL语句调优</a></li><li><a href="/2020/07/26/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql%E5%8E%9F%E7%90%86/">Mysql底层原理</a></li><li><a href="/2020/07/25/%E6%95%B0%E6%8D%AE%E5%BA%93/MySql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%BC%95%E6%93%8E/">MySql数据库的引擎</a></li><li><a href="/2020/07/15/BigDataFrame/HBase%E5%85%A5%E9%97%A8/">HBase入门</a></li></ul></div><div class="box widget"><div class="title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BI%E5%B7%A5%E5%85%B7/">BI工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETL%E5%B7%A5%E5%85%B7/">ETL工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="box widget"><div class="title">归档</div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">2020-08</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020-01</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a><span class="archive-list-count">1</span></li></ul></div></div></section><footer class="footer"><div class="global-width footer-box"><div class="copyright"><span>Copyright &copy; 2020</span> <span class="dotted">|</span> <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="dotted">|</span></div></div></footer></div><script>hljs.initHighlightingOnLoad()</script></body></html>