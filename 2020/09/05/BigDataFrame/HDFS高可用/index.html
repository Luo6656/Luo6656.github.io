<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="author" content="Eric"><meta name="keywords" content=""><meta name="description" content="HDFS高可用机制一、概述由于HDFS中最重要的就是NameNode,所以NameNode的可用性直接决定了Hadoop的可用性，一旦NameNode进程不能工作，就会影响集群的正常运行。
在典型的HA集群中，两台独立的机器被配置为NameNode。在工作集群中，NameNode机器中的一个处..."><meta name="Robots" content="all"><title>Eric个人博客 | HDFS高可用机制</title><link rel="icon" href="/images/icon.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/highlight.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Eric个人博客" type="application/atom+xml"></head><body><div class="main-container"><header class="header"><div class="global-width"><nav class="nav-box"><a class="nav-item" href="/">主页</a> <a class="nav-item" href="/resume">项目</a> <a class="nav-item" href="/mood" target="_blank">热点观点</a> <a class="nav-item" href="/2018/01/01/introduce/" target="_blank">个人介绍</a> <a class="nav-item" href="/fuye.md">关于</a></nav></div></header><section class="content global-width"><div class="main"><article class="box post"><div class="post-title align-center detail-title">HDFS高可用机制</div><div class="post-meta align-center"><span class="label">原创</span> <span class="dotted">|</span> <i class="fa fa-calendar"></i> <time>2020-09-05</time> <span class="dotted">|</span> <i class="fa fa-user"></i> Eric <span class="dotted">|</span> <i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a></div><div class="post-content"><h1 id="HDFS高可用机制"><a href="#HDFS高可用机制" class="headerlink" title="HDFS高可用机制"></a>HDFS高可用机制</h1><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>由于HDFS中最重要的就是NameNode,所以NameNode的可用性直接决定了Hadoop的可用性，一旦NameNode进程不能工作，就会影响集群的正常运行。</p><p>在典型的HA集群中，<font color="red">两台独立的机器</font>被配置为NameNode。在工作集群中，NameNode机器中的一个处于Active状态，另一个处于Standby状态。</p><h3 id="二、工作要点"><a href="#二、工作要点" class="headerlink" title="二、工作要点"></a>二、工作要点</h3><h5 id="1-元数据管理方式需要改变"><a href="#1-元数据管理方式需要改变" class="headerlink" title="1.元数据管理方式需要改变"></a>1.元数据管理方式需要改变</h5><a id="more"></a><p>内存中各自保存一份元数据；</p><p>Edits日志只有Active状态的NameNode节点可以做写操作；</p><p>两个NameNode都可以读取Edits；</p><p>共享的Edits放在一个共享存储中管理（qjournal和NFS两个主流实现）；</p><h5 id="2-需要一个状态管理功能模块"><a href="#2-需要一个状态管理功能模块" class="headerlink" title="2.需要一个状态管理功能模块"></a>2.需要一个状态管理功能模块</h5><p>实现了一个zkfailover，常驻在每一个namenode所在的节点，每一个zkfailover负责监控自己所在NameNode节点，利用zk进行状态标识，当需要进行状态切换时，由zkfailover来负责切换，切换时需要防止brain split现象的发生。</p><h5 id="3-必须保证两个NameNode之间能够ssh无密码登陆"><a href="#3-必须保证两个NameNode之间能够ssh无密码登陆" class="headerlink" title="3.必须保证两个NameNode之间能够ssh无密码登陆"></a>3.必须保证两个NameNode之间能够ssh无密码登陆</h5><h5 id="4-隔离，即同一时刻仅仅有一个NameNode对外提供服务"><a href="#4-隔离，即同一时刻仅仅有一个NameNode对外提供服务" class="headerlink" title="4.隔离，即同一时刻仅仅有一个NameNode对外提供服务"></a>4.隔离，即同一时刻仅仅有一个NameNode对外提供服务</h5><h3 id="三、结构组件"><a href="#三、结构组件" class="headerlink" title="三、结构组件"></a>三、结构组件</h3><p><img src="https://i.loli.net/2020/11/11/LHdw6cRahB4puNt.png" alt="image-20201111102728418"></p><h4 id="ZKFailoverController"><a href="#ZKFailoverController" class="headerlink" title="ZKFailoverController"></a>ZKFailoverController</h4><p>是基于Zookeeper的故障转移控制器，它负责控制NameNode的主备切换，ZKFailoverController会监测NameNode的健康状态，当发现Active NameNode出现异常时会通过Zookeeper进行一次新的选举，完成Avtive和Standby状态的切换</p><h4 id="HealthMonitor"><a href="#HealthMonitor" class="headerlink" title="HealthMonitor"></a>HealthMonitor</h4><p>周期性调用NameNode的HAServiceProtocol RPC接口监控NameNode的健康状态并向ZKFailoverController反馈</p><h4 id="AciveStandbyElector"><a href="#AciveStandbyElector" class="headerlink" title="AciveStandbyElector"></a>AciveStandbyElector</h4><p>接收ZKFC的选举请求，通过Zookeeper自动完成主备选举，选举玩抽回调ZKFailoverController的主备切换方法对NameNode进行Active和Standby状态的切换</p><h4 id="共享存储系统"><a href="#共享存储系统" class="headerlink" title="共享存储系统"></a>共享存储系统</h4><p>共享存储系统负责存储HDFS的元数据(EditsLog) , Active NameNode(写入) 和 Standby NameNode(读取) 通过共享存储系统实现元数据同步，在主备切换过程中，新的Active NameNode必须保证元数据同步完成才能对外提供服务</p><h3 id="三、HDFS-HA故障转移工作机制"><a href="#三、HDFS-HA故障转移工作机制" class="headerlink" title="三、HDFS-HA故障转移工作机制"></a>三、HDFS-HA故障转移工作机制</h3><p><img src="https://i.loli.net/2020/11/11/s4E5QWmJizlvVeZ.png" alt="image-20201111105612112"></p><p><img src="https://i.loli.net/2020/11/10/gJM4tr9knUXOdoZ.png" alt="image-20201110231836588"></p></div></article></div><div class="aside"><div class="box widget"><div class="introduction"><p><img src="/images/ironman.jpg" alt="head-sculpture"></p><p class="name">罗明辉Eric</p><p class="slogan">个人博客，分享经验，分享快乐</p></div></div><div class="box widget"><div class="title">最新</div><ul class="item-box"><li><a href="/2020/11/14/BigDataFrame/Canal/">(no title)</a></li><li><a href="/2020/11/13/BigDataFrame/Flink/">Flink</a></li><li><a href="/2020/09/26/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1/">数据仓库-建模</a></li><li><a href="/2020/09/20/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%9E%B6%E6%9E%84/">数据仓库-架构</a></li><li><a href="/2020/09/19/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E8%BF%B0/">数据仓库-概述</a></li><li><a href="/2020/09/18/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li><a href="/2020/09/10/BigDataFrame/YARN/">YARN</a></li><li><a href="/2020/09/06/BigDataFrame/HDFS%E8%81%94%E9%82%A6%E6%9C%BA%E5%88%B6/">HDFS联邦机制</a></li></ul></div><div class="box widget"><div class="title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BI%E5%B7%A5%E5%85%B7/">BI工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETL%E5%B7%A5%E5%85%B7/">ETL工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="box widget"><div class="title">归档</div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">2020-11</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">2020-05</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020-01</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a><span class="archive-list-count">1</span></li></ul></div></div></section><footer class="footer"><div class="global-width footer-box"><div class="copyright"><span>Copyright &copy; 2020</span> <span class="dotted">|</span> <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="dotted">|</span></div></div></footer></div><script>hljs.initHighlightingOnLoad()</script></body></html>