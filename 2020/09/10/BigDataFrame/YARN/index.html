<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="author" content="Eric"><meta name="keywords" content=""><meta name="description" content="YARN
ResourceManager作用
处理客户端请求
监控NodeManager
启动或监控ApplicationMaster
资源的分配和调度

负责处理客户端请求，对各NodeManager上的资源进行统一管理和调度。给ApplicationMaster分配空闲的Container..."><meta name="Robots" content="all"><title>Eric个人博客 | YARN</title><link rel="icon" href="/images/icon.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/highlight.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Eric个人博客" type="application/atom+xml"></head><body><div class="main-container"><header class="header"><div class="global-width"><nav class="nav-box"><a class="nav-item" href="/">主页</a> <a class="nav-item" href="/resume">项目</a> <a class="nav-item" href="/mood" target="_blank">热点观点</a> <a class="nav-item" href="/2018/01/01/introduce/" target="_blank">个人介绍</a> <a class="nav-item" href="/fuye.md">关于</a></nav></div></header><section class="content global-width"><div class="main"><article class="box post"><div class="post-title align-center detail-title">YARN</div><div class="post-meta align-center"><span class="label">原创</span> <span class="dotted">|</span> <i class="fa fa-calendar"></i> <time>2020-09-10</time> <span class="dotted">|</span> <i class="fa fa-user"></i> Eric <span class="dotted">|</span> <i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a></div><div class="post-content"><h1 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h1><p><img src="https://i.loli.net/2020/11/11/7CFfxilY9cM4Bpy.png" alt="image-20201111114651553"></p><h3 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h3><h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><ol><li>处理客户端请求</li><li>监控NodeManager</li><li>启动或监控ApplicationMaster</li><li>资源的分配和调度</li></ol><p>负责处理客户端请求，对各NodeManager上的资源进行统一管理和调度。给ApplicationMaster分配空闲的Container运行并监控其运行状态。主要由两个组件构成：调度器和应用程序管理器</p><h4 id="1-调度器-Scheduler"><a href="#1-调度器-Scheduler" class="headerlink" title="1. 调度器(Scheduler)"></a>1. 调度器(Scheduler)</h4><p>调度器根据容量、队列等限制条件，将系统中的资源分配给各个正在运行的应用程序。<font color="red">调度器仅根据各个应用程序的资源需求进行资源分配</font>，而资源分配的单位是Container。Scheduler不负责监控或者跟踪应用程序的状态。总之，调度器根据应用程序的资源要求，以及集群机器的资源情况，为应用程序分配封装在Container中的资源。</p><a id="more"></a><h4 id="2-应用程序管理器-Applications-Manager"><a href="#2-应用程序管理器-Applications-Manager" class="headerlink" title="2. 应用程序管理器(Applications Manager)"></a>2. 应用程序管理器(Applications Manager)</h4><p>应用程序管理器负责管理整个系统中所有应用程序，包括应用程序提交、与调度器协商资源以启动ApplicationMaster、监控ApplicationMaster运行状态并在失败时重新启动等，跟踪分给Container的进度、状态也是其职责</p><h3 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h3><h5 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h5><ol><li>管理单个节点上的资源</li><li>处理来自ResouceManager的命令</li><li>处理来自ApplicationMaster的命令</li></ol><p>是每个节点上的资源和任务管理器。它会定时地向ResourceManger汇报本节点上地资源使用情况和各个Container运行状态；同时接收并处理来自ApplicationMaster地Container启动/停止请求。</p><h3 id="ApplicationMaster"><a href="#ApplicationMaster" class="headerlink" title="ApplicationMaster"></a>ApplicationMaster</h3><ol><li>负责数据的切分</li><li>为应用程序申请资源并分配给内部的任务</li><li>任务的监控和容错</li></ol><p>用户提交地应用程序均包含一个ApplicationMaster,负责应用地监控，跟踪应用执行状态，重启失败任务等。ApplicationMaster是应用框架，它负责向ResouceManager协调资源，并且与NodeManager协同工作完成Task地执行和监控。</p><h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>Container是YARN中的资源抽象，它封装了某个节点上的多维度资源，如<font color="red">内存、CPU、磁盘、网络等</font>。当ApplicationMaster向RM盛情资源时，返回的资源就以Container表示。</p><h3 id="Yarn工作流程"><a href="#Yarn工作流程" class="headerlink" title="Yarn工作流程"></a>Yarn工作流程</h3><p><img src="https://i.loli.net/2020/11/11/Ntfe7ZU3KPr8Lnw.png" alt="image-20201111151508429"></p><h3 id="Yarn的调度器"><a href="#Yarn的调度器" class="headerlink" title="Yarn的调度器"></a>Yarn的调度器</h3><h4 id="FIFO调度器（很少使用）"><a href="#FIFO调度器（很少使用）" class="headerlink" title="FIFO调度器（很少使用）"></a>FIFO调度器（很少使用）</h4><p>job1先来先让job1工作完再给job2工作，这样job2就会等待很长时间</p><p><img src="https://i.loli.net/2020/11/11/4jYeUJO1NvycEon.png" alt="image-20201111155328581"></p><h4 id="容量调度器（apache版本默认使用）"><a href="#容量调度器（apache版本默认使用）" class="headerlink" title="容量调度器（apache版本默认使用）"></a>容量调度器（apache版本默认使用）</h4><p>而对于Capacity Scheduler，提前预留一个专门的通道给小任务执行，但是这样会预先占用一些资源，大任务只能利用80%的资源，就导致大任务的运行时间要大于FIFO的大任务的运行时间；如上图，而且小任务前后会造成资源浪费</p><p><img src="https://i.loli.net/2020/11/11/AOGI7F63yVYicl1.png" alt="image-20201111155443695"></p><h4 id="公平调度器（CDH版默认使用）"><a href="#公平调度器（CDH版默认使用）" class="headerlink" title="公平调度器（CDH版默认使用）"></a>公平调度器（CDH版默认使用）</h4><p><img src="https://i.loli.net/2020/11/11/5TIYjuoVtQgsHif.png" alt="image-20201111155620159"></p><p>Fair调度器的设计目标是为所有的应用分配公平的资源（对公平的定义可以通过参数来设置）。在上面的“Yarn调度器对比图”展示了一个队列中两个应用的公平调度；当然，公平调度在也可以在多个队列间工作。举个例子，假设有两个用户A和B，他们分别拥有一个队列。当A启动一个job而B没有任务时，A会获得全部集群资源；当B启动一个job后，A的job会继续运行，不过一会儿之后两个任务会各自获得一半的集群资源。如果此时B再启动第二个job并且其它job还在运行，则它将会和B的第一个job共享B这个队列的资源，也就是B的两个job会用于四分之一的集群资源，而A的job仍然用于集群一半的资源，结果就是资源最终在两个用户之间平等的共享。在Fair调度器中，我们不需要预先占用一定的系统资源，Fair调度器会为所有运行的job动态的调整系统资源。当第一个大job提交时，只有这一个job在运行，此时它获得了所有集群资源；当第二个小任务提交后，Fair调度器会分配一半资源给这个小任务，让这两个任务公平的共享集群资源。<br>a) 公平调度器，就是能够共享整个集群的资源<br>b) 不用预先占用资源，每一个作业都是共享的<br>c) 每当提交一个作业的时候，就会占用整个资源。如果再提交一个作业，那么第一个作业就会分给第二个作业一部分资源，第一个作业也就释放一部分资源。再提交其他的作业时，也同理。。。。也就是说每一个作业进来，都有机会获取资源</p></div></article></div><div class="aside"><div class="box widget"><div class="introduction"><p><img src="/images/ironman.jpg" alt="head-sculpture"></p><p class="name">罗明辉Eric</p><p class="slogan">个人博客，分享经验，分享快乐</p></div></div><div class="box widget"><div class="title">最新</div><ul class="item-box"><li><a href="/2020/09/26/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1/">数据仓库-建模</a></li><li><a href="/2020/09/20/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%9E%B6%E6%9E%84/">数据仓库-架构</a></li><li><a href="/2020/09/19/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E8%BF%B0/">数据仓库-概述</a></li><li><a href="/2020/09/18/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li><a href="/2020/09/10/BigDataFrame/YARN/">YARN</a></li><li><a href="/2020/09/06/BigDataFrame/HDFS%E8%81%94%E9%82%A6%E6%9C%BA%E5%88%B6/">HDFS联邦机制</a></li><li><a href="/2020/09/05/BigDataFrame/HDFS%E9%AB%98%E5%8F%AF%E7%94%A8/">HDFS高可用机制</a></li><li><a href="/2020/09/03/BigDataFrame/NM%E5%92%8CSNM%E5%92%8CDN/">NameNode|SecondaryNameNode|DataNode</a></li></ul></div><div class="box widget"><div class="title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BI%E5%B7%A5%E5%85%B7/">BI工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETL%E5%B7%A5%E5%85%B7/">ETL工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6/">大数据框架</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="box widget"><div class="title">归档</div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020-09</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020-07</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020-06</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">2020-05</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020-01</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019-12</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a><span class="archive-list-count">1</span></li></ul></div></div></section><footer class="footer"><div class="global-width footer-box"><div class="copyright"><span>Copyright &copy; 2020</span> <span class="dotted">|</span> <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="dotted">|</span></div></div></footer></div><script>hljs.initHighlightingOnLoad()</script></body></html>